<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InfoBot (RP Demo)</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      background: #f4f6ff;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }
    .wrap { width: 760px; padding: 16px; }
    .card {
      background: white;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.1);
    }
    #chat {
      height: 55vh;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 12px;
      padding: 10px;
      background: #fff;
    }
    .msg {
      padding: 10px 12px;
      border-radius: 14px;
      margin: 8px 0;
      max-width: 85%;
      white-space: pre-wrap;
    }
    .me { background: #e9f0ff; margin-left: auto; }
    .bot { background: #f5f5f5; }
    .row { display: flex; gap: 8px; margin-top: 10px; }
    input {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #ddd;
    }
    button {
      padding: 12px 16px;
      border-radius: 12px;
      border: none;
      background: #111827;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
    .chips { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
    .chip {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #ddd;
      cursor: pointer;
      background: #fff;
    }
    .status { font-size: 12px; color: #6b7280; margin-bottom: 6px; }
  </style>
</head>

<body>
<div class="wrap">
  <h2>InfoBot: RP Demo</h2>
  <div class="status" id="status">Status: ready</div>

  <div class="chips" id="chips">
    <div class="chip">Where is RP?</div>
    <div class="chip">How do I get to RP by MRT?</div>
    <div class="chip">What diplomas are offered?</div>
    <div class="chip">Give me official RP website link</div>
  </div>

  <div class="card">
    <div id="chat"></div>

    <div class="row">
      <input id="msg" placeholder="Type a question..." />
      <button id="send">Send</button>
    </div>
  </div>
</div>

<script>
const WEBHOOK_URL = "https://n8ngc.codeblazar.org/webhook/rp-chat";

const chat = document.getElementById("chat");
const input = document.getElementById("msg");
const btn = document.getElementById("send");
const status = document.getElementById("status");

function add(text, who) {
  const div = document.createElement("div");
  div.className = "msg " + who;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function setStatus(t) {
  status.textContent = "Status: " + t;
}

async function send(customMsg) {
  // âœ… capture message FIRST
  const raw = typeof customMsg === "string" ? customMsg : input.value;
  const message = (raw || "").trim();
  if (!message) return;

  // âœ… clear AFTER capture
  input.value = "";
  add(message, "me");

  btn.disabled = true;
  setStatus("thinkingâ€¦");

  try {
    const res = await fetch(WEBHOOK_URL + "?t=" + Date.now(), {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message })
    });

    const data = await res.json();
    add(data.reply || "(No reply)", "bot");
    setStatus("ready");
  } catch (e) {
    add("ðŸ˜µ Error contacting server.", "bot");
    setStatus("error");
  } finally {
    btn.disabled = false;
    input.focus();
  }
}

btn.onclick = () => send();
input.addEventListener("keydown", e => { if (e.key === "Enter") send(); });

document.getElementById("chips").addEventListener("click", e => {
  const chip = e.target.closest(".chip");
  if (!chip) return;
  send(chip.textContent.trim());
});

// welcome
add("Hi! Iâ€™m InfoBot (RP). Ask me anything about RP ðŸ˜Š", "bot");
</script>
</body>
</html>
